<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reconexi√≥n de Servicio - Sistema Agua LOTI</title>
    <link rel="stylesheet" href="../css/reconexion.css">
    <link rel="icon" href="../images/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <button class="back-btn" onclick="window.location.href='mainPage.html'">
                ‚Üê Volver al Men√∫ Principal
            </button>
            <h1 class="page-title">üîå Reconexi√≥n de Servicio</h1>
            <button class="logout-btn" onclick="AuthUtils.logout()">
                Cerrar Sesi√≥n üîê
            </button>
        </div>

        <!-- Buscador de Cliente -->
        <div class="search-section">
            <h3>Buscar Cliente para Reconexi√≥n</h3>
            <div class="search-box">
                <input
                    type="text"
                    id="searchCliente"
                    placeholder="Buscar por nombre, DPI o n√∫mero de contador..."
                    class="search-input">
                <button class="btn-primary" onclick="reconexionManager.buscarCliente()">
                    üîç Buscar
                </button>
            </div>
        </div>

        <!-- Informaci√≥n del Cliente -->
        <div id="clienteInfo" class="cliente-info">
            <h3>Informaci√≥n del Cliente</h3>
            <div class="info-grid">
                <div class="info-item">
                    <strong>Nombre:</strong>
                    <span id="clienteNombre"></span>
                </div>
                <div class="info-item">
                    <strong>DPI:</strong>
                    <span id="clienteDPI"></span>
                </div>
                <div class="info-item">
                    <strong>Contador:</strong>
                    <span id="clienteContador"></span>
                </div>
                <div class="info-item">
                    <strong>Estado de Servicio:</strong>
                    <span id="clienteEstado" class="badge"></span>
                </div>
                <div class="info-item">
                    <strong>Reconexiones Previas:</strong>
                    <span id="numeroReconexiones">0</span>
                </div>
            </div>
            <button class="btn-primary" onclick="reconexionManager.verificarReconexion()">
                üîç Verificar Opciones de Reconexi√≥n
            </button>
        </div>

        <!-- Opciones de Reconexi√≥n -->
        <div id="opcionesReconexion" class="opciones-section">
            <div class="opciones-header">
                <h3>Opciones de Reconexi√≥n Disponibles</h3>
                <span id="mesesAtraso" class="meses-badge"></span>
            </div>

            <!-- Resumen de Deuda -->
            <div class="deuda-summary">
                <div class="summary-item">
                    <div class="summary-label">Deuda Total</div>
                    <div class="summary-value" id="deudaTotal">Q0.00</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Costo de Reconexi√≥n</div>
                    <div class="summary-value fixed">Q125.00</div>
                </div>
            </div>

            <!-- Opciones de Pago -->
            <div class="payment-options">
                <!-- Opci√≥n 80% -->
                <div class="option-card" id="option80" onclick="reconexionManager.seleccionarOpcion('parcial')">
                    <div class="option-header">
                        <input type="radio" name="paymentOption" value="parcial" id="radioParcial">
                        <label for="radioParcial">
                            <h4>Opci√≥n 80% - Pago Parcial</h4>
                        </label>
                    </div>
                    <div class="option-body">
                        <div class="option-detail">
                            <span>Pago de Deuda (80%):</span>
                            <strong id="montoParcialDeuda">Q0.00</strong>
                        </div>
                        <div class="option-detail">
                            <span>Costo de Reconexi√≥n:</span>
                            <strong>Q125.00</strong>
                        </div>
                        <div class="option-detail highlight">
                            <span>Saldo Pendiente (20%):</span>
                            <strong id="saldoPendiente80">Q0.00</strong>
                        </div>
                        <div class="option-total">
                            <span>Total a Pagar Ahora:</span>
                            <strong id="totalParcial">Q0.00</strong>
                        </div>
                        <div class="option-info">
                            <p>‚úì Reconexi√≥n inmediata</p>
                            <p>‚úì Pagas el 80% de la deuda</p>
                            <p>‚ö†Ô∏è Quedar√°s con saldo pendiente</p>
                        </div>
                    </div>
                </div>

                <!-- Opci√≥n 100% -->
                <div class="option-card recommended" id="option100" onclick="reconexionManager.seleccionarOpcion('total')">
                    <div class="recommended-badge">‚≠ê Recomendado</div>
                    <div class="option-header">
                        <input type="radio" name="paymentOption" value="total" id="radioTotal">
                        <label for="radioTotal">
                            <h4>Opci√≥n 100% - Pago Total</h4>
                        </label>
                    </div>
                    <div class="option-body">
                        <div class="option-detail">
                            <span>Pago de Deuda (100%):</span>
                            <strong id="montoTotalDeuda">Q0.00</strong>
                        </div>
                        <div class="option-detail">
                            <span>Costo de Reconexi√≥n:</span>
                            <strong>Q125.00</strong>
                        </div>
                        <div class="option-detail success">
                            <span>Descuento (5%):</span>
                            <strong id="montoDescuento">-Q0.00</strong>
                        </div>
                        <div class="option-total">
                            <span>Total a Pagar:</span>
                            <strong id="totalCompleto">Q0.00</strong>
                        </div>
                        <div class="option-info">
                            <p>‚úì Reconexi√≥n inmediata</p>
                            <p>‚úì Liquidas toda la deuda</p>
                            <p>‚úì 5% de descuento incluido</p>
                            <p>‚úì Sin saldo pendiente</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detalle de Facturas -->
            <div class="facturas-detalle">
                <h4>Facturas que se Pagar√°n</h4>
                <div id="facturasDetalle"></div>
            </div>

            <!-- Bot√≥n de Continuar -->
            <div class="action-buttons">
                <button class="btn-secondary" onclick="reconexionManager.cancelar()">
                    Cancelar
                </button>
                <button class="btn-primary" id="btnContinuar" disabled onclick="reconexionManager.mostrarFormularioPago()">
                    Continuar con Pago ‚Üí
                </button>
            </div>
        </div>

        <!-- Formulario de Pago -->
        <div id="formularioPago" class="pago-section">
            <h3>Confirmar Pago de Reconexi√≥n</h3>

            <div class="pago-resumen">
                <div class="resumen-item">
                    <span>Opci√≥n Seleccionada:</span>
                    <strong id="resumenOpcion"></strong>
                </div>
                <div class="resumen-item">
                    <span>Monto de Deuda:</span>
                    <strong id="resumenDeuda"></strong>
                </div>
                <div class="resumen-item">
                    <span>Costo de Reconexi√≥n:</span>
                    <strong>Q125.00</strong>
                </div>
                <div class="resumen-item total">
                    <span>Total a Pagar:</span>
                    <strong id="resumenTotal"></strong>
                </div>
            </div>

            <form id="formPago" onsubmit="reconexionManager.procesarPago(event)">
                <div class="form-group">
                    <label for="metodoPago">M√©todo de Pago *</label>
                    <select id="metodoPago" required>
                        <option value="">Seleccione un m√©todo</option>
                        <option value="efectivo">Efectivo</option>
                        <option value="tarjeta">Tarjeta</option>
                        <option value="transferencia">Transferencia Bancaria</option>
                        <option value="cheque">Cheque</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="montoPago">Monto Recibido *</label>
                    <input
                        type="number"
                        id="montoPago"
                        step="0.01"
                        min="0"
                        placeholder="0.00"
                        required>
                </div>

                <div class="form-group">
                    <label for="referenciaPago">Referencia / No. de Transacci√≥n</label>
                    <input
                        type="text"
                        id="referenciaPago"
                        placeholder="Opcional">
                </div>

                <div class="form-group">
                    <label for="observaciones">Observaciones</label>
                    <textarea
                        id="observaciones"
                        rows="3"
                        placeholder="Comentarios adicionales (opcional)"></textarea>
                </div>

                <div class="action-buttons">
                    <button type="button" class="btn-secondary" onclick="reconexionManager.volverOpciones()">
                        ‚Üê Volver
                    </button>
                    <button type="submit" class="btn-success">
                        ‚úì Procesar Reconexi√≥n
                    </button>
                </div>
            </form>
        </div>

        <!-- Modal de Confirmaci√≥n -->
        <div id="modalConfirmacion" class="modal">
            <div class="modal-content success">
                <div class="modal-icon">‚úì</div>
                <h2>¬°Reconexi√≥n Exitosa!</h2>
                <div class="modal-body">
                    <p>La reconexi√≥n ha sido procesada correctamente.</p>
                    <div class="confirmacion-detalle">
                        <div class="detalle-item">
                            <span>Cliente:</span>
                            <strong id="confirmCliente"></strong>
                        </div>
                        <div class="detalle-item">
                            <span>Monto Pagado:</span>
                            <strong id="confirmMonto"></strong>
                        </div>
                        <div class="detalle-item">
                            <span>Facturas Pagadas:</span>
                            <strong id="confirmFacturas"></strong>
                        </div>
                        <div class="detalle-item">
                            <span>Saldo Pendiente:</span>
                            <strong id="confirmSaldo"></strong>
                        </div>
                        <div class="detalle-item">
                            <span>Estado del Servicio:</span>
                            <strong class="estado-activo">ACTIVO</strong>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" onclick="reconexionManager.imprimirComprobante()">
                        üñ®Ô∏è Imprimir Comprobante
                    </button>
                    <button class="btn-primary" onclick="reconexionManager.nuevaReconexion()">
                        Nueva Reconexi√≥n
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>Procesando...</p>
        </div>

        <!-- Message Display -->
        <div id="message" class="message"></div>
    </div>

    <!-- Scripts -->
    <script src="../js/auth.js"></script>
    <script src="../js/pageProtection.js"></script>
    <script src="../js/reconexion.js"></script>
</body>
</html>
